<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <head th:replace="~{fragments/header :: header_content}"></head>
  <title>Daftar Peminjaman</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
<div class="container-fluid p-0">
  <th:block th:replace="~{fragments/navbar :: navbar}"></th:block>
</div>
<div class="container mt-4">

  <h2 class="mb-4">Daftar Peminjaman</h2>

  <div th:if="${message}" class="alert alert-info alert-dismissible fade show" role="alert">
    <p th:text="${message}"></p>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <div class="mb-3">
    <a th:href="@{/peminjaman/new}" class="btn btn-primary">Tambah Peminjaman Baru</a>
  </div>

  <table class="table table-striped table-bordered">
    <thead class="table-dark">
    <tr>
      <th>ID</th>
      <th>Anggota</th>
      <th>Buku</th>
      <th>Tanggal Peminjaman</th>
      <th>Tanggal Pengembalian</th>
      <th>Aksi</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="peminjaman : ${peminjamanPage.content}">
      <td th:text="${peminjaman.id}"></td>
      <td th:text="${peminjaman.anggota != null ? peminjaman.anggota.namaAnggota : 'N/A'}"></td>
      <td th:text="${peminjaman.buku != null ? peminjaman.buku.judulBuku : 'N/A'}"></td>
      <td th:text="${peminjaman.tanggalPeminjaman}"></td>
      <td th:text="${peminjaman.tanggalPengembalian != null ? peminjaman.tanggalPengembalian : 'Belum Dikembalikan'}"></td>
      <td>
        <a th:href="@{/peminjaman/edit/{id}(id=${peminjaman.id})}" class="btn btn-warning btn-sm">Edit</a>
        <a th:if="${peminjaman.tanggalPengembalian == null}" th:href="@{/peminjaman/return/{id}(id=${peminjaman.id})}" class="btn btn-success btn-sm" onclick="return confirm('Apakah Anda yakin ingin mengembalikan buku ini?');">Kembalikan</a>
        <a th:href="@{/peminjaman/delete/{id}(id=${peminjaman.id})}" class="btn btn-danger btn-sm" onclick="return confirm('Apakah Anda yakin ingin menghapus peminjaman ini?');">Hapus</a>
      </td>
    </tr>
    <tr th:if="${peminjamanPage.content.isEmpty()}">
      <td colspan="6">Tidak ada data peminjaman.</td>
    </tr>
    </tbody>
  </table>

  <nav aria-label="Page navigation">
    <ul class="pagination">
      <li th:classappend="${currentPage == 1 ? 'disabled' : ''}" class="page-item">
        <a class="page-link" th:href="@{/peminjaman(page=${currentPage - 1}, size=${pageSize}, sort=${sortField} + ',' + ${sortDir})}">Previous</a>
      </li>
      <li th:each="i : ${pageNumbers}" th:classappend="${i == currentPage ? 'active' : ''}" class="page-item">
        <a class="page-link" th:href="@{/peminjaman(page=${i}, size=${pageSize}, sort=${sortField} + ',' + ${sortDir})}" th:text="${i}"></a>
      </li>
      <li th:classappend="${currentPage == peminjamanPage.totalPages ? 'disabled' : ''}" class="page-item">
        <a class="page-link" th:href="@{/peminjaman(page=${currentPage + 1}, size=${pageSize}, sort=${sortField} + ',' + ${sortDir})}">Next</a>
      </li>
    </ul>
  </nav>
</div>

<div th:replace="~{fragments/footer}"></div>
</body>
</html>